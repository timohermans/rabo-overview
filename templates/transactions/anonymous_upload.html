{% extends "base.html" %}
{% load filters %}
{% load statistics %}

{% block content %}
{% if form %}
<div class="center">
	<form method="post" enctype="multipart/form-data">
		{% csrf_token %}
		{{ form }}
		<div>
			<input type="submit" value="Upload" />
		</div>
	</form>
</div>
{% endif %}

{% if results %}

<div class="center">
	<div class="stack">
		<section class="box stack">
			<div class="cluster" style="--justify:space-between;">
				{% for account in results.accounts|receivers %}
				<span>{{ account.account_number|short_account_number }}</span>
				{% endfor %}
			</div>
			{% for receiver in results.accounts|receivers %}
			<div class="stack">
				<div>Selected receiver: {{ receiver.name }}</div>
				{% for transaction in results.transactions|of_receiver:receiver%}
				<div>{{ transaction.other_party.name }} - {{ transaction.amount }}</div>
				{% endfor %}
			</div>
			{% endfor %}
		</section>

		{% transactions_box transactions=results.transactions|top_expenses:5 title='Uitgaven' sub_title='Top 5 grootste uitgaven' %}

		{% transactions_box transactions=results.transactions|top_incomes:3 title='Inkomsten' sub_title='Top 5 grootste inkomsten' %}

		<section class="box stack">
			<h2>Transactions</h2>

			<table>
				<tbody>
					{% for transaction in results.transactions %}
					<tr>
						<td>{{ transaction.date }}</td>
						<td>{{ transaction.other_party.name }}</td>
						<td>{{ transaction.amount }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</section>
	</div>
</div>
{% endif %}
{% endblock %}